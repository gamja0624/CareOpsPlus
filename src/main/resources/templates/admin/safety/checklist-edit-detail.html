<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8">
    <!-- title 지정 -->
    <title>CareOps+ | 안전관리</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/web-settings.css}" rel="stylesheet">

    <style type="text/css">
      /* 층버튼 */
      .btn-floor-line {display: flex; flex-flow: wrap; margin: 20px auto; width: 500px; }
      .btn-floor { margin: 10px 10px; width: 80px;}
    
    
      /* 테이블 */
      .layout-table { margin-bottom: 10px; height: 700px; text-align: center; }
      .inner-layout-table { padding-top: 20px; height: 600px; }
      .table { 
        margin: 0 auto 0 auto;
      	display: inline-table;
      	width: 650px;
      	text-align: center;
      }
      .table-head { font-weight: bold; font-size: 20px; }
      .table-row { line-height: 20px; border-bottom: 1px solid #d9d9d9; }
      .table-row>th, td { padding: 4px; vertical-align: middle; }
      .smcNo { width: 50px; text-align: center; border: 1px solid #13254C; border-radius: 5px; }
      .smcList { width: 450px; border: 1px solid #13254C; border-radius: 5px; }
      
      /* 목록 */
      .list-input {
      	width: 100%;
      	border: 1px solid #13254C;
      	border-radius: 5px;
      	padding-left: 5px;
      }
      .list-td { width: 400px; }
      .table-row-last { text-align: center; }
      
      /* 빼기 아이콘 */
      .minus-icon {
      	vertical-align: middle;
      	width: 25px;
      	line-height: 25px;
      }
      .minus-icon-a { cursor: pointer; }
      
      /* 더하기 아이콘 */
      .plus-icon {
      	vertical-align: middle;
      	width: 25px;
      	line-height: 25px;
      }
      .plus-icon-a { cursor: pointer; }
      
      /* 페이지네이션 */
      
      /* 버튼 */
      .btn-line {
      	display: flex;
      	justify-content: center;
      	margin-top: 20px;
      }
      .page-back { margin-right: 10px; }
      .btn-edit { margin-left: 10px; }
      .btn-edit-comple { margin-left: auto; }
      .btn { background-color: #13254C; color: white; }
      .btn:hover { border: 1px solid #13254C; }
    </style>
  </head>
  <body>
    <!-- 사이드바 -->
    <th:block th:replace="~{/common/side-bar}"></th:block>
  
    <!-- 컨텐츠 영역 -->
    <div class="content">
      <!-- 안전관리 목록 -->
      <div class="section">
        <h1 class="title">
          점검표 항목 수정 <img alt="이동" th:src="@{/img/icon-next-b.png}"
            class="title-next"> [[${smlList}]]
        </h1>
        <!-- 제목 -->
        <div class="layout-table">
          <div class="btn-floor-line">
            <th:block th:each="num : ${#numbers.sequence(1, 10)}">
              <div th:classappend="${num} > 5 ? 'floor-row-2' : 'floor-row-1'">
                <button 
                  class="btn btn-floor" 
                  th:text="${num} + 'F'" 
                  th:data-smlList="${smlList}" 
                  th:data-num="${num}"
                  th:onclick="'fetchChecklist(this.getAttribute(\'data-smlList\'), this.getAttribute(\'data-num\'))'"
                 >
                </button>
              </div>
            </th:block>
          </div>
          <div class="table-outline">
            <form th:action="@{/admin/safety-checklist-edit/{smlList}(smlList = ${smlList})}" method="post">
              <table class="table table-hover">
                <thead>
                  <tr class="table-row table-head">
                    <th scope="col">No.</th>
                    <th scope="col">점검 리스트</th>
                  </tr>
                </thead>
                <tbody id="checklistBody">
                  <tr class="table-row data-row" th:each="checklist, iter : ${allChecklist}">
                    <td hidden="hidden"><input name="smcFloor" th:value="${checklist.smcFloor}" ></td>
                    <td><input class="smcNo" name="smcNo" type="text" th:value="${checklist.smcNo}" readonly="readonly"></td>
                    <td><input class="smcList" name="smcList" type="text" th:value="${checklist.smcList}"></td>
                  </tr>
                </tbody>
              </table>
              <div class="btn-line">
                <div class="page-back">
                  <button onclick="history.back()" class="btn" type="button">뒤로 가기</button>
                </div>
                <div class="btn-edit">
                  <button class="btn btn-edit-comple" type="submit">수정 완료</button>
                </div>
              </div>
            </form>
          </div>
        </div>
	  </div>
    </div>
    <script type="text/javascript">
      function fetchChecklist(smlList, num) {
    	  console.log( smlList, num);
          // URL 형식: admin/safety-checklist-edit/{smlList}/{num}
          const url = `/admin/safety-checklist-edit/${smlList}/${num}`; 
          console.log('Fetching URL:', url); // URL 확인
          
          fetch(url)
              .then(response => {
                  if (!response.ok) {
                      throw new Error('네트워크의 연결상태를 확인해주세요.');
                  }
                  return response.json();
              })
              .then(data => {
                  const checklistBody = document.getElementById('checklistBody');
                  checklistBody.innerHTML = ''; // 기존 내용 지우기
  
                  data.forEach(checklist => {
                      const row = document.createElement('tr');
                      row.className = 'table-row data-row';
  
                      // 새로운 행을 만들어 데이터 추가
                      row.innerHTML = `
                          <td hidden="hidden"><input name="smcFloor" value="${checklist.smcFloor}"></td>
                          <td><input class="smcNo" name="smcNo" type="text" value="${checklist.smcNo}" readonly="readonly"></td>
                          <td><input class="smcList" name="smcList" type="text" value="${checklist.smcList}"></td>
                      `;
                      
                      checklistBody.appendChild(row);
                  });
              })
              .catch(error => console.error('Error fetching checklist:', error));
      }
	</script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
  </body>
</html>